<div style="
  background: #ffffff;
  border-radius: 16px;
  padding: 25px 35px;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
  border: 1px solid #e0e0e0;
  margin-top: 40px;
">
  <h2 style="
    font-size: 1.8rem;
    font-weight: 700;
    color: #1a5748;
    border-bottom: 2px solid #1a5748;
    padding-bottom: 8px;
  ">{{#if rotina.id}}Editar Rotina{{else}}Cadastro de Rotina{{/if}}</h2>

  {{#if error}}
    <div class="alert alert-danger">{{error}}</div>
  {{/if}}

  <form method="post" 
    action="{{#if rotina.id}}/rotina/editar/{{rotina.id}}{{else}}/rotina/novo/salvar{{/if}}" 
    style="
      display: flex;
      flex-direction: column;
      gap: 10px;
      flex-grow: 1;
  ">
    
    <label 
      for="nome"
      style="
        font-weight: 600; 
        color: #133E34;
      ">Nome</label>
    <input 
      type="text" 
      name="nome" 
      id="nome" 
      value="{{rotina.nome}}" 
      required
      style="
        flex: 1;          
        border-radius: 10px;
        border: 1px solid #E5E5E5;
        padding: 10px 14px;
    ">

    <label 
      for="frequencia"
      style="
        font-weight: 600; 
        color: #133E34;
      "
    >Frequência</label>
    <select 
      name="frequencia" 
      id="frequencia" 
      required
      style="
        width: 100%;
        border-radius: 10px; 
        border: 1px solid #E5E5E5; 
        padding: 10px;
      ">
      <option value="">Selecione</option>
      {{#each frequencias}}
        <option value="{{this}}" {{ifEquals this ../rotina.frequencia}}>{{this}} vez(es)</option>
      {{/each}}
    </select>

    
    <label
      style="
      font-weight: 600; 
      color: #133E34;
    ">Dias da irrigação:</label>
      <div 
        style="display: flex; flex-wrap: wrap; gap: 10px;">
        {{#each diasSemana}}
          <div style="display: flex; align-items: center; gap: 4px;">
            <input               
              type="checkbox" 
              name="dias" 
              value="{{this}}" 
              id="{{this}}" 
              {{#if (includes this ../rotina.dias)}}checked{{/if}} 
              style="accent-color: #1A5748;">
            <label for="{{this}}" style="text-transform: capitalize; color: #333;">
              {{this}}
            </label>
          </div>
        {{/each}}
      </div>

    <!-- Horário(s) -->
    <div class="mb-3">
      <label style="font-weight: 600; color: #133E34;">Horário(s) de Irrigação</label>
      <div id="horarios-container">
         {{#each (range 1 rotina.frequencia)}}
          <div class="mb-2">
            <label style="color: #133E34;">Horário {{this}}</label>
            <input 
              type="time" 
              name="horarios[]"  
              value="{{../rotina.horarios.[@index]}}" 
              style="
                width: 100%;
                border-radius: 10px; 
                border: 1px solid #ccc; 
                padding: 10px
              "
              required>
          </div>
        {{/each}}
      </div>
    </div>

    <label 
      for="tipo_execucao"
       style="font-weight: 600; 
       color: #133E34;
    ">Tipo de Execução</label>
      <select 
        name="tipo_execucao" 
        id="tipo_execucao"
        required
        style="
          width: 100%;
          border-radius: 10px; 
          border: 1px solid #E5E5E5; 
          padding: 10px;
        ">
        <option value="">Selecione</option>
        <option value="Automático" {{ifEquals rotina.tipo_execucao "Automático"}}>Automático</option>
        <option value="Inteligente" {{ifEquals rotina.tipo_execucao "Inteligente"}}>Inteligente</option>
      </select>

    <div style="
        display: flex;
        justify-content: center; 
        gap: 20px;
        margin-top: 30px;
    ">
      <a href="/rotina/listagem"
        style="
        background-color: #CDE3DC;
        border: none;
        color: #133E34;
        font-weight: 500;
        border-radius: 10px;
        padding: 10px 18px;
        text-decoration: none;"
      >
        <i class="fa-solid fa-circle-xmark"></i>                   
        <span>Cancelar</span>
      </a>
      <button type="submit" class="btn btn-primary" style="
        background-color: #133E34;
        border: none;
        color: white;
        font-weight: 500;
        border-radius: 10px;
        padding: 10px 18px;
      ">
      {{#if rotina.id}}Atualizar{{else}}Cadastrar{{/if}}     
    </button>

    </div>
    
  </form>
</div>

<script>
  const frequencia = document.getElementById('frequencia');
  const container = document.getElementById('horarios-container');

  frequencia.addEventListener('change', () => {
    let n = parseInt(frequencia.value) || 0;
    if (n > 4) n = 4;
    container.innerHTML = '';

    for (let i = 1; i <= n; i++) {
      const div = document.createElement('div');
      div.classList.add('mb-2');
      div.innerHTML = `
        <div style="margin-bottom: 10px;">
          <label style="font-weight: 600; color: #133E34;">Horário ${i}</label>
          <input 
            type="time" 
            name="horarios[]" 
            style="
              width: 10%;
              border-radius: 10px; 
              border: 1px solid #ccc; 
              padding: 8px
            " required>
        </div>
        
      `;
      container.appendChild(div);
    }
  });
</script>
