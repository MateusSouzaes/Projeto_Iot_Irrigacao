<div style="
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(180deg, #eef6f2 0%, #dfeee8 100%);
  min-height: 100vh;
  padding: 25px 25px;
  display: flex;
  flex-direction: column;
">
  <div style="
    display: flex;
    justify-content: space-between;
    align-items: flex-start;  
    flex-wrap: wrap;   
  ">
    <!-- Dados da leitura -->
    <div class="card-dados" style="
      flex: 1.3;
      max-width: 550px;
      background: #fff;
      border-radius: 14px;
      padding: 20px 22px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.08);
      font-family: 'Poppins', sans-serif;
    ">
      <h2 style="
        color:#133E34; 
        font-weight:700; 
        font-size:1.1rem; 
        margin-bottom:8px;
      ">
        Dados da Leitura
      </h2>
      <div class="dados-lista" style="
          display: flex;
          flex-direction: column;
          gap: 12px;
      ">
        <div class="linha-dado" style="
            display: flex;
            justify-content: flex-start;
            align-items: center;
            gap: 15px;
            background: #F7F9F8;
            padding: 10px 12px;
            border-radius: 10px;
        ">
          <i class="fa-solid fa-cloud-rain"></i>
          <span class="label" style="
            color: #133E34;
            font-weight: 600;
            font-size: 0.9rem;
          ">Sensor de chuva:</span>
          <span 
            class="valor" 
            id="sensorChuva" 
            style="
              color: #1A5F4A;
              font-weight: 700;
              font-size: 1rem;
              margin-left: auto;
          ">--</span>
        </div>

        <div class="linha-dado" style="
            display: flex;
            justify-content: flex-start;
            align-items: center;
            gap: 15px;
            background: #F7F9F8;
            padding: 10px 12px;
            border-radius: 10px;
        ">
          <i class="fa-solid fa-droplet"></i>
          <span class="label" style="
            color: #133E34;
            font-weight: 600;
            font-size: 0.9rem;
          ">Sensor de umidade:</span>
          <span 
            class="valor" 
            id="sensorUmidade" 
            style="
              color: #1A5F4A;
              font-weight: 700;
              font-size: 1rem;
              margin-left: auto;
          ">--</span>
        </div>

        <div class="linha-dado" style="
            display: flex;
            justify-content: flex-start;
            align-items: center;
            gap: 15px;
            background: #F7F9F8;
            padding: 10px 12px;
            border-radius: 10px;
        ">
          <i class="fa-solid fa-tint" style="transform: rotate(90deg);"></i>
          <span class="label" style="
            color: #133E34;
            font-weight: 600;
            font-size: 0.9rem;
          ">Fluxo (mL/min):</span>
          <span 
            class="valor" 
            id="sensorFluxo" 
            style="
              color: #1A5F4A;
              font-weight: 700;
              font-size: 1rem;
              margin-left: auto;
          ">--</span>
        </div>

        <div class="linha-dado" style="
            display: flex;
            justify-content: flex-start;
            align-items: center;
            gap: 15px;
            background: #F7F9F8;
            padding: 10px 12px;
            border-radius: 10px;
        ">
          <i class="fa-solid fa-box" ></i>
          <span class="label" style="
            color: #133E34;
            font-weight: 600;
            font-size: 0.9rem;
          ">Volume total (L):</span>
          <span 
            class="valor" 
            id="sensorVolume" 
            style="
              color: #1A5F4A;
              font-weight: 700;
              font-size: 1rem;
              margin-left: auto;
          ">--</span>
        </div>

        <div class="linha-dado" style="
            display: flex;
            justify-content: flex-start;
            align-items: center;
            gap: 15px;
            background: #F7F9F8;
            padding: 10px 12px;
            border-radius: 10px;
        ">
          <i class="fa-solid fa-calendar-days"></i>
          <span class="label" style="
            color: #133E34;
            font-weight: 600;
            font-size: 0.9rem;
          ">Data:</span>
          <span 
            class="valor" 
            id="dataLeitura" 
            style="
              color: #1A5F4A;
              font-weight: 700;
              font-size: 1rem;
              margin-left: auto;
          ">--</span>
        </div>
      </div>
    </div>

 <!-- ðŸŒ¤ï¸ PREVISÃƒO DO TEMPO -->
{{#if previsao}}
<div style="
  background:#fff;
  margin-top:20px;
  padding:16px 20px;
  border-radius:14px;
  box-shadow:0 3px 10px rgba(0,0,0,0.10);
  width:100%;
">
  <h3 style="
    color:#133E34; 
    margin-bottom:14px; 
    font-size:1.2rem; 
    font-weight:700;
  ">
    PrevisÃ£o para os prÃ³ximos dias
  </h3>

  <div style="
    display:flex; 
    gap:14px; 
    overflow-x:auto; 
    padding-bottom:8px;
  ">
    {{#each previsao}}
      <div style="
        min-width:140px;
        background:#f3faf6;
        border-radius:12px;
        padding:14px 10px;
        text-align:center;
        box-shadow:0 1px 4px rgba(0,0,0,0.08);
      ">
        <p style="font-size:0.9rem; font-weight:700; color:#1a4d42;">
          {{this.diaSemana}}
        </p>

        <p style="font-size:0.85rem; font-weight:600; color:#3a6f62; margin-top:-4px;">
          {{this.dataFormatada}}
        </p>

        <img src="{{this.icone}}" style="width:55px; margin:6px 0;">

        <p style="font-size:0.85rem; color:#0077b6; margin-top:4px;">
          â˜” {{this.porcent_chuva}}%
        </p>

        <p style="font-size:1.1rem; font-weight:700; color:#133E34;">
          {{this.temp}}Â°C
        </p>

        <p style="font-size:0.85rem; color:#4a4a4a; margin-top:4px;">
          {{this.descricao}}
        </p>
      </div>
    {{/each}}
  </div>
</div>
{{/if}}


<!-- ðŸ”Œ Dados em tempo real do ESP -->
<div style="
  background:#E8F5EE;
  border-radius:12px;
  padding:12px 15px;
  margin-bottom:14px;
  border:1px solid #D4EDE2;
">
  <h3 style="
    color:#0F3A2F;
    font-size:0.95rem;
    font-weight:700;
    margin-bottom:10px;
    display:flex;
    align-items:center;
    gap:6px;
  ">
    <i class="fa-solid fa-microchip" style="color:#1A5F4A;"></i>
    Status do ESP8266
  </h3>

  <div style="
    display:flex;
    justify-content:space-between;
    font-size:0.85rem;
    color:#0F3A2F;
    font-weight:600;
    margin-bottom:6px;
  ">
    <span>IP do Dispositivo:</span>
    <span id="espIp" style="font-weight:700; color:#1A5F4A;">--</span>
  </div>

  <div style="
    display:flex;
    justify-content:space-between;
    font-size:0.85rem;
    color:#0F3A2F;
    font-weight:600;
    margin-bottom:6px;
  ">
    <span>Ãšltima atualizaÃ§Ã£o:</span>
    <span id="espAtualizacao" style="font-weight:700; color:#1A5F4A;">--</span>
  </div>

  <div style="
    display:flex;
    justify-content:space-between;
    font-size:0.85rem;
    color:#0F3A2F;
    font-weight:600;
  ">
    <span>Status:</span>
    <span id="espStatus" style="font-weight:700; color:#1A5F4A;">Conectando...</span>
  </div>
</div>

<!-- CLIMA -->
<div id="container">
  {{#if clima}}
    <div id="weather" class="show">
      <h2 id="title">
        {{clima.cidade}}, {{clima.estado}}
      </h2>

      <div id="temp">
        <img id="temp_img" src="{{clima.icone}}" alt="icone do clima">
        <div>
          <p id="temp_value">{{clima.temp}}Â°C</p>
          <p id="temp_description">{{clima.descricao}}</p>
        </div>
      </div>

      <div id="other_infos">
        <div class="info">
          <i id="temp_max_icon" class="fa-solid fa-temperature-high"></i>
          <div>
            <h2>MÃ¡x</h2>
            <p id="temp_max">{{clima.temp_max}}Â°C</p>
          </div>
        </div>

        <div class="info">
          <i id="temp_min_icon" class="fa-solid fa-temperature-low"></i>
          <div>
            <h2>MÃ­n</h2>
            <p id="temp_min">{{clima.temp_min}}Â°C</p>
          </div>
        </div>

        <div class="info">
          <i id="humidity_icon" class="fa-solid fa-droplet"></i>
          <div>
            <h2>Umidade</h2>
            <p id="humidity">{{clima.umidade}}%</p>
          </div>
        </div>

        <div class="info">
          <i id="wind_icon" class="fa-solid fa-wind"></i>
          <div>
            <h2>Vento</h2>
            <p id="wind">{{clima.vento}} km/h</p>
          </div>
        </div>
      </div>
    </div>
  {{else}}
    <p>NÃ£o foi possÃ­vel obter o clima atual.</p>
  {{/if}}
</div>

<!-- MINHAS PLANTAS -->
<div style="
  background: #ffffff;
  border-radius: 12px;
  padding: 15px 20px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
  width: 80%;
  margin-top: 16px;             
  margin-left: 0;    
  margin-right: auto;
">
  <div style="
    display: flex; 
    justify-content: space-between; 
    align-items: center;
    margin-bottom: 12px;
  ">
    <h2 style="
      font-size: 1.1rem; 
      font-weight: 700; 
      color: #133E34;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 6px;
    ">
      <i class="fa-solid fa-seedling" style="font-size: 1rem;"></i>
      Minhas Plantas
    </h2>

    <a href="/planta/listagem" style="
      color: #1a5748; 
      text-decoration: none; 
      font-weight: 600;
      font-size: 0.85rem;
    ">
      Ver todas â†’
    </a>
  </div>

  {{#if ultimasPlantas.length}}
    <div style="
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: space-between;
    ">
      {{#each ultimasPlantas}}
        <div style="
          flex: 1;
          min-width: 220px;
          background: #f9fdfb;
          border-radius: 10px;
          padding: 12px 14px;
          border: 1px solid #e0e0e0;
          box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        ">
          <h3 style="
            color: #133E34; 
            font-size: 1rem; 
            font-weight: 700; 
            margin-bottom: 6px;
          ">
            {{this.nome}}
          </h3>

          <p style="
            color: #4b4b4b; 
            font-size: 0.85rem;
            margin: 0 0 4px 0;
          ">
            <i class="fa-solid fa-list-check"></i>
            <strong>Rotina:</strong> {{this.rotina.nome}}
          </p>

          <p style="
            color: #4b4b4b; 
            font-size: 0.82rem;
            margin: 0;
          ">
            <i class="fa-solid fa-calendar-days"></i>
            <strong>Cadastro:</strong> {{dateFormat this.createdAt}}
          </p>
        </div>
      {{/each}}
    </div>
  {{else}}
    <p style="text-align: center; color: #666; margin-top: 10px; font-size: 0.85rem;">
      Nenhuma planta cadastrada ainda.
    </p>
  {{/if}}
</div>




</div>

<script>
async function atualizarStatusESP() {
  try {
    const resp = await fetch('/esp/status');
    if (!resp.ok) throw new Error('Erro no servidor');

    const dados = await resp.json();

    const display = dados?.display ?? {};

    document.getElementById("sensorChuva").innerText =
      display.chuva ?? "--";

    document.getElementById("sensorUmidade").innerText =
      display.umidade ?? "--";

    document.getElementById("sensorFluxo").innerText =
      display.fluxo_ml_min ?? "--";

    document.getElementById("sensorVolume").innerText =
      display.volume_l_total ?? "--";

    document.getElementById("dataLeitura").innerText =
      display.data ?? "--";

    document.getElementById("espIp").innerText = dados.ip ?? "--";

    document.getElementById("espAtualizacao").innerText =
      dados.ultimaAtualizacao ?? "--";

    document.getElementById("espStatus").innerText =
      dados.online ? "Online" : "Offline";

  } catch (e) {
    document.getElementById("espStatus").innerText = "Erro";
  }
}

setInterval(atualizarStatusESP, 3000);
atualizarStatusESP();
</script>
